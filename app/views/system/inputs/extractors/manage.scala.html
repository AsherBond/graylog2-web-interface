@(currentUser: User, breadcrumbs: lib.BreadcrumbList, node: Node, input: Input, extractors: List[Extractor])

@main("Extractors", views.html.system.sidebar(), "", currentUser) {

    @views.html.partials.breadcrumbs(breadcrumbs)

    <div class="row-fluid">
        <h1>
            <i class="icon icon-beaker"></i>
            Extractors of <em>@input.getTitle</em>
        </h1>

        Extractors are applied on every message that is received by this input. Use them to extract and transform
        any text data into fields that allow you easy filtering and analysis later on.
        Example: Extract the HTTP response code from a log message, transform it to a numeric field and attach it
        as <em>http_response_code</em> to the message.
    </div>

    <div class="row-fluid xtrc-select-message">
        <h2>
            <i class="icon icon-signin"></i>
            Add extractor
        </h2>

        <div class="subcontainer">
            Start by loading a message so we have an example to work on.

            <div class="buttons">
                <button class="btn btn-small xtrc-load-recent" data-node-id="@node.getNodeId" data-input-id="@input.getId">
                    Load a message recently received by this input
                </button>

                <button class="btn btn-small xtrc-load-manual" data-node-id="@node.getNodeId" data-input-id="@input.getId">
                    Manually load a message
                </button>
            </div>
        </div>

        <div class="manual-selector" style="display: none;">
            You can load any message manually using the form below. The <em>message ID</em> and <em>index</em>
            can be found in the detail view of any message. Make sure that the selected message has the exact
            same format as those received by this input or you extractor might now match.
            <form class="form-inline manual-selector-form">
                <input type="text" name="message_id" class="input-xlarge" placeholder="Message ID" required="true">
                <input type="text" name="index" class="input-medium" placeholder="Index" required="true">
                <button type="submit" class="btn manual-selector-load">Load message</button>
            </form>
        </div>

        <div class="xtrc-message" style="display: none;">
            We found this message.
            <strong>Next step:</strong>
            Select a field you want to apply the extractor on by clicking on its name.

            <div class="well well-small">
                <h2>Message <span></span></h2>
                <dl class="xtrc-message-fields">
                </dl>
            </div>


        </div>
    </div>

    <div class="row-fluid xtrc-wizard" style="display: none;">
        <h2>
            <i class="icon icon-signin"></i>
            Add extractor on field
            <span class="xtrc-wizard-field"></span>
        </h2>

        <div class="well well-small">
            <strong>Example:</strong>
            <span class="xtrc-wizard-example"></span>
        </div>

        <form action="@routes.ExtractorsController.newExtractor(node.getNodeId, input.getId)" method="GET">
            <label for="extractor_type">How do you want to extract data from this field?</label>
            <select name="extractor_type" id="extractor_type">
                @for(et <- Extractor.Type.values()) {
                    <option value="@et.toString.toLowerCase">@Extractor.typeToHuman(et)</option>
                }
            </select>

            <input type="hidden" name="field" value="" />
            <input type="hidden" name="example" value="" />
            <button type="submit" class="btn btn-success">Next step</button>
        </form>
    </div>

    <div class="row-fluid xtrc-list-container">
        <h2>
            <i class="icon icon-cogs"></i>
            Configured extractors
        </h2>

        @if(extractors.size() > 0) {
            @for(extractor <- extractors) {
                <div class="row-fluid node-row">
                    <h3><i class="icon icon-ellipsis-vertical"></i> @extractor.getTitle (@Extractor.typeToHuman(extractor.getType))</h3>

                    <span class="pull-right node-row-info node-row-info-negative-correction">
                        <span class="text">Added by @views.html.partials.links.to_user(extractor.getCreatorUser)</span>
                            &nbsp;

                        <form action="@routes.ExtractorsController.delete(node.getNodeId, input.getId, extractor.getId)" method="POST">
                            <button class="btn btn-danger btn-mini" type="submit" data-confirm="Really remove extractor?">
                                Remove
                            </button>
                        </form>
                    </span>

                    <div class="extractor-row-summary">
                        @views.html.system.inputs.extractors.partials.extractor_summary(extractor)
                    </div>

                    <div class="well well-small">
                        <h4>Additional config:</h4>
                        <ul>
                            @for((k,v) <- extractor.getExtractorConfig) {
                                <li>@k: @v</li>
                            }
                        </ul>
                    </div>
                </div>
            }
        } else {
            <div class="alert alert-danger">This input has no configured extractors.</div>
        }
    </div>

}